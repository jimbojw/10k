<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>10k personal search engine</title>
<style type="text/css">body{font-family:'Helvetica Neue',Arial,'Liberation Sans',FreeSans,sans-serif;width:600px;margin:0 auto;background:#eee;}h1{background:#036;color:white;padding:1em 0;font-size:2.5em;text-align:center;background-image:-moz-linear-gradient(center bottom,#1b4080 32%,#486bb3 72%);background-image:-webkit-gradient(linear,left bottom,left top,color-stop(0.32,#1b4080),color-stop(0.72,#486bb3));-moz-border-radius:8px;border-radius:8px;text-shadow:#333 1px 1px 1px;}dt{font-size:1.1em;}dd{margin-left:0;margin-bottom:2.5em;}dd p{margin:1em 0;}a,a:visited{color:#06c;}input[type=text]{width:100%;border:1px solid #aaa;}input[type=submit],input[type=button]{border:1px solid #aaa;background-image:-moz-linear-gradient(center bottom,#ddd 32%,#f3f3f3 72%);background-image:-webkit-gradient(linear,left bottom,left top,color-stop(0.32,#ddd),color-stop(0.72,#f3f3f3));-moz-border-radius:3px;border-radius:2px;padding:.25em 1em;font-size:medium;}.search form p{text-align:center;}.results{margin-top:2em;}.pane{clear:both;background:white;border:1px solid #aaa;margin-bottom:1em;padding:0 1em 1em;-moz-border-radius:8px;border-radius:8px;display:none;min-height:250px;}.pane.selected{display:inherit;}ul{list-style-type:square;color:#06c;}li{margin-bottom:.5em;}#add{display:block;margin:1em auto;width:5em;background:#f30;color:white;padding:.5em;font-size:2.5em;text-align:center;background-image:-moz-linear-gradient(center bottom,#c92200 32%,#f30 72%);background-image:-webkit-gradient(linear,left bottom,left top,color-stop(0.32,#c92200),color-stop(0.72,#f30));-moz-border-radius:8px;border-radius:8px;text-shadow:#333 1px 1px 1px;text-decoration:none;}.prefs ul{margin:0;padding:0;list-style-type:none;}.prefs li{display:inline;padding:0 2em;}.saved{background:#ff0;padding:.5em 1em;}.about img{float:right;padding:0;margin:0;position:relative;top:-30px;}.about p{margin:1em;}nav ul{margin:0 1em;padding:0;list-style-type:none;}nav li{float:left;margin:0 .6em;padding:.25em 1em;background:#ddd;-moz-border-radius-topRight:6px;-moz-border-radius-topLeft:6px;border-top-right-radius:6px;border-top-left-radius:6px;border:1px solid #aaa;border-bottom:none;color:#444;cursor:pointer;}nav .selected{color:#06c;background:#fff;z-index:1;position:relative;top:1px;}.auto{position:absolute;background:#fff;padding:0;margin:0;border:none;}.auto ul{margin:0;padding:0;list-style-type:none;border:1px solid #ccc;}.auto li{margin:0;padding:.25em .5em;}.auto .selected{background:#f0f0f0;}</style>
</head>
<body>
<!--html-->
<div class="container">
<h1><span>10k personal search engine</span></h1>
<nav>
<ul>
<li class="welcome">welcome</li>
<li class="search">search</li>
<li class="allpages">all pages</li>
<li class="prefs">preferences</li>
<li class="about">about</li>
</ul>
</nav>
<div class="search pane">
<div>
<h2><span>Search</span></h2>
<form>
<p><input type="text" name="search" autocomplete="off" /></p>
<p>
<input type="submit" name="submit" value="Search" />
<input type="button" name="web" value="Web" />
</p>
</form>
</div>
<div class="results"><dl></dl></div>
</div>
<div class="welcome pane">
<h2><span>Welcome</span></h2>
<p>
The 'add' button below is a 
<a href="http://en.wikipedia.org/wiki/Bookmarklet" title="wikipedia:bookmarklet">bookmarklet</a>.
</p>
<ol>
<li>Drag it to your bookmarks toolbar or add it to your favorites.</li>
<li>When you're on a page you want to add, click the bookmark.</li>
<li>That page will now appear in your <a href="#search" class="nav">search results</a>!</li>
</ol>
<p><a href="" title="Add to search engine" id="add"><span>add</span></a></p>
</div>
<div class="allpages pane">
<h2><span>All pages</span></h2>
<div>
<p>Sorry, it looks like you haven't added any pages yet.</p>
<p>Use the bookmarklet in the <a href="#welcome" class="nav">welcome tab</a> to add some.</p>
</div>
</div>
<div class="prefs pane">
<h2><span>Preferences</span></h2>
<form>
<p>When using the 'web' search option, use this url where <tt>%s</tt> is the query param:</p>
<p><input type="text" /></p>
<p>Enter your own walue, or select from the following:</p>
<ul>
<li><a href="http://www.ask.com/web?q=%s" title="ask">ask</a></li>
<li><a href="http://www.bing.com/search?q=%s" title="bing">bing</a></li>
<li><a href="http://www.google.com/#q=%s" title="google" class="def">google</a></li>
<li><a href="http://search.yahoo.com/search?p=%s" title="yahoo">yahoo</a></li>
</ul>
<p><input type="submit" name="save" value="Save" /> <span class="saved" style="visibility:hidden">Saved!</span></p>
</form>
</div>
<div class="about pane">
<h2><span>About</span></h2>
<p>
This is an application I've wanted to write for a long time, but never could due to browser constraints.
</p>
<p>
The <a href="http://10k.aneventapart.com/" title="10k apart">10k apart contest</a> seemed like the perfect 
excuse to finally sit down and actually do it.
</p>
<h2><span>Code</span></h2>
<p>
All the source code for this project is available on github at 
<a href="http://github.com/jimbojw/10k" title="jimbojw/10k">jimbojw/10k</a>.
</p>
<h2><span>Contact</span></h2>
<img src="http://chart.apis.google.com/chart?cht=qr&chs=120x120&chl=MECARD%3AN%3AJim+R.+Wilson%3BTEL%3A8168985108%3BURL%3Ahttp%3A%2F%2Fhexlib.com%2F%3BEMAIL%3Awilson.jim.r%40gmail.com%3B%3B" />
<ul>
<li>Jim R. Wilson</li>
<li><a href="mailto:wilson.jim.r@gmail.com" title="wilson.jim.r@gmail.com">wilson.jim.r@gmail.com</a></li>
<li><a href="http://hexlib.com/" title="hexlib.com">http://hexlib.com/</a></li>
</div>
</div>
<!--/html-->
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script>(function(l){var p=l.localStorage,k=l.JSON.stringify,n=l.JSON.parse;l=l["10kse"]={};for(var f="able|about|across|after|all|almost|also|among|and|any|are|because|been|but|can|cannot|could|dear|did|does|either|else|ever|every|for|from|get|got|had|has|have|her|hers|him|his|how|however|into|its|just|least|let|like|likely|may|might|most|must|neither|nor|not|off|often|only|other|our|own|rather|said|say|says|she|should|since|some|than|that|the|their|them|then|there|these|they|this|tis|too|twas|wants|was|were|what|when|where|which|while|who|whom|why|will|with|would|yet|you|your".split("|"),
g={},i=0,c=f.length;i<c;i++)g[f[i]]=true;l.asc=function(a,b){return a-b};l.get=function(a){return(a=p.getItem("10kse-"+a))?n(a):a};l.set=function(a,b){return p.setItem("10kse-"+a,k(b))};l.stop=g})(window);
(function(l,p){function k(c){var a=p(".pane."+c+", nav ."+c);if(!a.length)throw"no such tab named '"+c+"'";i&&i.removeClass(g);i=a.addClass(g);f("TAB",c)}var n=l.get,f=l.set,g="selected",i;k(n("TAB")||"welcome");p("nav li").click(function(){p(this).hasClass("active")||k(this.className)});p("a.nav").click(function(c){c.preventDefault();c=this.href;c=c.substr(c.lastIndexOf("#")+1);k(c)});l.showtab=k})(window["10kse"],jQuery);
(function(l,p){var k=l.get,n=l.set,f=p(".prefs.pane"),g=f.find("input").eq(0),i=f.find(".saved"),c=k("S")||"";if(!c){c=f.find(".def").attr("href");n("S",c)}g.val(c);f.find("li a").click(function(a){a.preventDefault();g.val(this.href)});f.find("form").submit(function(a){a.preventDefault();c=g.val();n("S",c);i.css({visibility:"",opacity:1});setTimeout(function(){i.animate({opacity:0},"slow")},1E3)})})(window["10kse"],jQuery);
(function(l){function p(f){for(var g=this.data,i,c,a=0,b=f.length;a<b;a++){c=f.charAt(a);(i=g[c])||(i=g[c]={});g=i}g.$=1}function k(f){for(var g=this.data,i,c=0,a=f.length;c<a;c++){i=f.charAt(c);g=g[i];if(!g)return null;g=g}return g}function n(f){var g=this.find(f);if(!g)return[];for(var i=[[f,g]],c=[],a=0,b;i.length;){g=i.shift();f=g[0];g=g[1];if(g.$)c[a++]=f;for(b in g)if(b!=="$")i[i.length]=[f+b,g[b]]}c.sort();return c}l.trie=function(f){return{add:p,data:f,find:k,match:n}}})(window["10kse"],jQuery);
(function(l){l.scanner=function(p,k,n){function f(w,y){var z;if(w.currentStyle)z=w.currentStyle[y];else if(p.getComputedStyle)z=c.getComputedStyle(w,null).getPropertyValue(y);return z}function g(w){return f(w,"display")!=="none"&&f(w,"visiblity")!=="hidden"}function i(w){var y=w.parentNode,z=y.parentNode,A=(w.innerText||w.textContent).replace(h," "),B=A.length;w=1;if(B>25){if(y[d]===n){y[d]=0;a[b++]=y}if(z[d]===n){z[d]=0;a[b++]=y}w+=A.split(",").length;A=B*0.01<<0;w+=A<4?A:3;y[d]+=w;z[d]+=w*0.5}}
var c=k.defaultView,a=[],b=0,d="10score",h=/\s+/g,j,e,m,t,q=k.getElementsByTagName("p");j=0;for(e=q.length;j<e;j++)i(q[j]);q=k.getElementsByTagName("div");var v,u=/<(a|blockquote|dl|div|img|ol|p|pre|table|ul|br)/i;j=0;for(e=q.length;j<e;j++){v=q[j];u.test(v.innerHTML)&&i(v)}u=null;var s;for(j=0;j<b;j++){e=a[j];q=e.getElementsByTagName("a");m=s=0;for(t=q.length;m<t;m++){v=q[m];s+=(v.innerText||v.textContent).length}e[d]=score=e[d]*(1-s/(e.innerText||e.textContent).length);if(!u||score>u[d])u=e}u=u||
k.body;q=k.getSelection()||"";s="h1,h2,h3,h4,h5,h6,pre,code".split(",");v=[];var o,r;j=0;for(e=s.length;j<e;j++){o=k.getElementsByTagName(s[j]);m=0;for(t=o.length;m<t;m++){r=o[m];g(r)&&v.push(r.textContent)}}m=[];u=[u];var x;t=/[a-z][a-z][a-z]/i;for(s=/button|link|noscript|script|style/i;e=u.shift();){o=e.childNodes;j=0;for(e=o.length;j<e;j++){r=o[j];x=r.nodeType;if(x===1&&!s.test(r.tagName)&&g(r))u[u.length]=r;else if(x===3){text=r.nodeValue;if(t.test(text))m[m.length]=text}}}p["10kse"].iframe.contentWindow.postMessage(JSON.stringify({url:k.location.href,
selection:q,title:k.title,priority:v.join(" "),content:m.join(" ")}),"*")}})(window["10kse"]);
(function(l){function p(a){var b,d,h,j=0,e,m={};d=a.split(g);a=0;for(b=d.length;a<b;a++){j++;h=d[a];e=h.toLowerCase();if(h.length>2&&!i[e]){(h=m[e])||(h=m[e]=[]);h[h.length]=j}}return m}function k(a,b,d,h){if((d=""+d)&&/[a-z]/i.test(d)){d=p(d);var j,e,m;for(j in d){e=n("W-"+j)||{};(m=e[a])||(m=e[a]={});m[b]=d[j];f("W-"+j,e);h[j]=1}}}var n=l.get,f=l.set,g=/[^0-9a-z_]+/i,i=l.stop,c=l.trie;l.extract=p;l.indexer=function(a){var b,d=n("URL-"+a.url);if(d){b=d.id;if(a.content!==d.text||a.title!==d.title)f("URL-"+
a.url,{id:b,text:a.content,title:a.title})}else{b=n("COUNT")||0;f("ID-"+b,a.url);f("COUNT",b+1);f("URL-"+a.url,{id:b,text:a.content,title:a.title})}d={};k(b,"s",a.selection,d);k(b,"t",a.title,d);k(b,"p",a.priority,d);k(b,"c",a.content,d);a=n("ALL")||{};b=c(a);var h;for(h in d)b.add(h);f("ALL",a)}})(window["10kse"],window);
(function(l,p,k,n){var f=n.get,g=n.set,i=p.location.href;f=f("K");if(!f){f=Math.random();g("K",f)}i=JSON.stringify(i.replace(/#.*|$/,"#"+f));g="javascript:("+(function(c,a,b){var d=c["10kse"];d||(d=c["10kse"]={});if(d.scanner)return d.scanner();c.addEventListener("message",function(e){if(b.substr(0,e.origin.length)===e.origin){d.scanner=new Function(e.data);d.scanner()}},false);var h=d.iframe=a.createElement("iframe");c=h.style;h.setAttribute("src",b);c.width=c.height="1px";c.top=c.left="-2px";c.border=
"none";c.position="absolute";var j=false;h.onload=h.onreadystatechange=function(){if(!j&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){j=true;h.onload=h.onreadystatechange=null;h.contentWindow.postMessage("script",b)}};a.body.appendChild(h)}+"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/\s+/g," ")+")(window,document,"+i+")";k("#add").attr("href",g).click(function(c){c.preventDefault();alert("1. Drag this link to your bookmarks,\n2. Navigate to another page,\n3. Click the bookmarklet to add that page to your search engine.")});
if(l!==l.top)p.location.hash==="#"+f?l.addEventListener("message",function(c){c.data==="script"?c.source.postMessage("("+n.scanner+")(window,document)","*"):n.indexer(JSON.parse(c.data))},false):alert("Either your bookmarklet is out of date, or a malicious site \nis trying to add itself to your search index. \n\nIn any case, you should update your 'add' bookmarklet. Thanks!")})(window,document,jQuery,window["10kse"]);
(function(l,p,k){if(k===k.top){l=l.get;k=l("COUNT")||0;var n,f;if(k>0)for(var g=p("<ul></ul>").appendTo(p(".allpages").find("div").empty());k>0;){k--;n=l("ID-"+k);f=l("URL-"+n);p("<li><a></a></li>").find("a").attr("href",n).attr("title",f.title).text(f.title).end().appendTo(g)}}})(window["10kse"],jQuery,window);
(function(l,p){var k=l.get;l.wordcount=function(n,f,g,i){i||(i={});for(var c={},a,b,d,h=0,j=f.length;h<j;h++){a=f[h];if(a.length>2&&!stop[a]){b=i[a];if(b===p)b=i[a]=k("W-"+a);if(b)for(d in n)if(a=b[d])if(a=a[g]){if(c[d]===p)c[d]=0;c[d]+=+a.length}}}return c};l.normalize=function(n,f,g){if(f===p)f=1;if(g===p)g=0.5;var i={},c,a,b,d;for(c in n){d=i[c]=n[c]*f;if(a===p||d>a)a=d;if(b===p||d<b)b=d}if(a===b){for(c in i)i[c]=g;return i}for(c in i)i[c]=(i[c]-b)*(1/(a-b));return i};l.topdistance=function(n,
f,g,i){i||(i={});var c={},a,b,d,h;for(d in n){h=null;for(var j=0,e=f.length;j<e;j++){a=f[j];if(a.length>2&&!stop[a]){b=i[a];if(b===p)b=i[a]=k("W-"+a);if(b)if(a=b[d])if(a=a[g])if(h===null||a[0]<h)h=a[0]}}if(h!==null)c[d]=h}return c}})(window["10kse"]);
(function(l,p,k){var n=p("<div></div>");l.highlight=function(f,g,i){if(i===k)i=true;f=n.text(f).html();var c=f.toLowerCase(),a={},b={},d=[],h,j,e,m,t,q;h=0;for(j=g.length;h<j;h++){e=g[h].toLowerCase();m=e.length;if(m>2&&!a[e]){a[e]=true;for(q=t=0;t<3;){q=c.indexOf(e,q);if(q===-1)break;var v=f.charAt(q-1).toLowerCase(),u=f.charAt(q+m).toLowerCase();if((v<"a"||v>"z")&&(u<"a"||u>"z")){t++;d[d.length]=q;b[q]=e}q+=m}}}d.sort(l.asc);g=[];c=0;m=d.length;for(h=q=0;c<200&&h<=m;){a=d[h];e=h<m?f.substr(q,a-
q):f.substr(q);j=e.length;if(i)if(h===m){if(j>50)e=e.substr(0,46)+" ..."}else if(h===0){if(j>50)e="... "+e.substr(j-50-4)}else if(j>100)e=e.substr(0,47)+" ... "+e.substr(j-50-3);g[g.length]=e;c+=e.length;if(h<m){e=b[a];g[g.length]="<b>"+f.substr(a,e.length)+"</b>";c+=e.length;q=a+e.length}h++}if(c>=200&&h<=m)g[g.length]=" ...";return g.join("")}})(window["10kse"],jQuery);
(function(l){var p=l.get,k=l.trie,n,f;l.suggest=function(g){g=g.replace(/^\s+|\s$/g,"").toLowerCase();var i=p("COUNT")||0;if(!g||!i)return[];if(i!==void 0){n=p("ALL");f=k(n)}return f.match(g).slice(0,15)}})(window["10kse"]);
(function(l,p,k){function n(h){function j(){if(s){var o=s.text(),r=t.val(),x=r.lastIndexOf(" ")+1;t.val(u=r.substr(0,x)+o);s.removeClass(b);s=null}m()}function e(){if(v.find("li").length){var o=t.offset();q.css({top:o.top+h.offsetHeight,left:o.left,width:h.offsetWidth});q.show()}}function m(){q.hide()}var t=k(h),q=k('<div class="auto"><ul></ul></div>').css({display:"none"}).appendTo(document.body),v=q.find("ul"),u="",s=null;t.bind("change keyup",function(o){var r=t.val();o=o.which;if(o===c||o===g)j();
else if(o===a)m();else if(o===f||o===i){if(s)if(o===f){r=s.prev();if(r.length){s.removeClass(b);s=r.addClass(b)}}else{r=s.next();if(r.length){s.removeClass(b);s=r.addClass(b)}}else s=v.find("li").eq(0).addClass(b);e()}else if(r!==u){u=r;o=r.lastIndexOf(" ");r=r.substr(o<0?0:o).toLowerCase();if(r.length)if((o=d(r))&&o.length){v.empty();s=null;for(var x=0,w=o.length;x<w;x++)k("<li><span></span></li>").appendTo(v).find("span").html(o[x].split(r,2).join("<b>"+r+"</b>"));e()}else m();else m()}}).parent("form").submit(j);
v.mouseover(function(o){o=k(o.target);o=o.is("li")?o:o.parent("li");if(o=o.length?o:null){s&&s.get(0)!==o.get(0)&&s.removeClass(b);s=o.addClass(b)}}).click(j);k("body").click(m)}var f=38,g=39,i=40,c=13,a=27,b="selected",d=p.suggest;k(".search input").eq(0).each(function(){n(this)});p.autocomplete=n})(window,window["10kse"],jQuery);
(function(l,p,k,n){function f(){var b=(c.val()||"").replace(/^\s+|\s+$/g,""),d=b.toLowerCase().split(/[^a-z0-9_]/),h,j,e={},m,t={};if(!(!b||b===a)){a=b;h=0;for(j=d.length;h<j;h++){b=d[h];if(!t[b])if(b=t[b]=g("W-"+b))for(m in b)e[m]=(e[m]||0)+1}b=k.wordcount;var q=k.normalize,v=k.topdistance;e=[[1,q(e)],[1,q(b(e,d,"s",t))],[1,q(b(e,d,"t",t))],[1,q(b(e,d,"p",t))],[1,q(b(e,d,"c",t))],[1,q(v(e,d,"s",t),-1)],[1,q(v(e,d,"t",t),-1)],[1,q(v(e,d,"p",t),-1)],[1,q(v(e,d,"c",t),-1)]];var u={};h=0;for(j=e.length;h<
j;h++){b=e[h];t=b[0];b=b[1];for(m in b){u[m]||(u[m]=0);u[m]+=t*b[m]}}var s=[];e=0;var o={},r,x;for(m in u){r=u[m];x=o[r]||(o[r]=[]);x[x.length]=m;s[e++]=r}s.sort(k.asc);s.reverse();var w=k.highlight,y=null;i.slideUp("slow",function(){i.empty();h=0;for(j=s.length;h<j;h++){r=s[h];if(r!==y){y=r;x=o[r];for(var z=0,A=x.length;z<A;z++){m=x[z];var B=g("ID-"+m),C=g("URL-"+B),D=C.text;i.append(n("<dt><a></a></dt>").find("a").attr("href",B).attr("title",C.title).html(w(C.title,d,false)).end(),n("<dd><p></p></dd>").find("p").html(w(D,
d)).end().append("<p><strong>Score: "+(u[m]+"").substr(0,4)+"</strong></p>"))}}}i.slideDown("slow")})}}var g=k.get,i=n(".results dl"),c=n(".search input").eq(0),a;n("form").submit(function(b){b.preventDefault();setTimeout(f,150)});n(".search").find("input[name=web]").click(function(){l.location.assign((g("S")||"").replace("%s",encodeURIComponent(c.val()||"")))});n(function(){c.focus()})})(window,document,window["10kse"],jQuery);
</script>
</body>
</html>

