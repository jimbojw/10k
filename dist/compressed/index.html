<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>10k personal search engine</title>
<style type="text/css">body{font-family:'Helvetica Neue',Arial,'Liberation Sans',FreeSans,sans-serif;width:600px;margin:0 auto;background:#eee;}h1{background:#036;color:white;padding:1em 0;font-size:2.5em;text-align:center;background-image:-moz-linear-gradient(center bottom,#1b4080 32%,#486bb3 72%);background-image:-webkit-gradient(linear,left bottom,left top,color-stop(0.32,#1b4080),color-stop(0.72,#486bb3));-moz-border-radius:8px;border-radius:8px;text-shadow:#333 1px 1px 1px;}dt{font-size:1.1em;}dd{margin-left:0;margin-bottom:2.5em;}dd p{margin:1em 0;}a,a:visited{color:#06c;}input[type=text]{width:100%;border:1px solid #aaa;}input[type=submit],input[type=button]{border:1px solid #aaa;background-image:-moz-linear-gradient(center bottom,#ddd 32%,#f3f3f3 72%);background-image:-webkit-gradient(linear,left bottom,left top,color-stop(0.32,#ddd),color-stop(0.72,#f3f3f3));-moz-border-radius:3px;border-radius:2px;padding:.25em 1em;font-size:medium;}.search form p{text-align:center;}.results{margin-top:2em;}.pane{clear:both;background:white;border:1px solid #aaa;margin-bottom:1em;padding:0 1em 1em;-moz-border-radius:8px;border-radius:8px;display:none;min-height:250px;}.pane.selected{display:inherit;}ul{list-style-type:square;color:#06c;}li{margin-bottom:.5em;}#add{display:block;margin:1em auto;width:5em;background:#f30;color:white;padding:.5em;font-size:2.5em;text-align:center;background-image:-moz-linear-gradient(center bottom,#c92200 32%,#f30 72%);background-image:-webkit-gradient(linear,left bottom,left top,color-stop(0.32,#c92200),color-stop(0.72,#f30));-moz-border-radius:8px;border-radius:8px;text-shadow:#333 1px 1px 1px;text-decoration:none;}.prefs ul{margin:0;padding:0;list-style-type:none;}.prefs li{display:inline;padding:0 2em;}.saved{background:#ff0;padding:.5em 1em;}.about img{float:right;padding:0;margin:0;position:relative;top:-30px;}.about p{margin:1em;}nav ul{margin:0 1em;padding:0;list-style-type:none;}nav li{float:left;margin:0 .6em;padding:.25em 1em;background:#ddd;-moz-border-radius-topRight:6px;-moz-border-radius-topLeft:6px;border-top-right-radius:6px;border-top-left-radius:6px;border:1px solid #aaa;border-bottom:none;color:#444;cursor:pointer;}nav .selected{color:#06c;background:#fff;z-index:1;position:relative;top:1px;}.auto{position:absolute;background:#fff;padding:0;margin:0;border:none;}.auto ul{margin:0;padding:0;list-style-type:none;border:1px solid #ccc;}.auto li{margin:0;padding:.25em .5em;}.auto .selected{background:#f0f0f0;}</style>
</head>
<body>
<!--html-->
<div class="container">
<h1><span>10k personal search engine</span></h1>
<nav>
<ul>
<li class="welcome">welcome</li>
<li class="search">search</li>
<li class="allpages">all pages</li>
<li class="prefs">preferences</li>
<li class="about">about</li>
</ul>
</nav>
<div class="search pane">
<div>
<h2><span>Search</span></h2>
<form>
<p><input type="text" name="search" autocomplete="off" /></p>
<p>
<input type="submit" name="submit" value="Search" />
<input type="button" name="web" value="Web" />
</p>
</form>
</div>
<div class="results"><dl></dl></div>
</div>
<div class="welcome pane">
<h2><span>Welcome</span></h2>
<p>
The 'add' button below is a 
<a href="http://en.wikipedia.org/wiki/Bookmarklet" title="wikipedia:bookmarklet">bookmarklet</a>.
</p>
<ol>
<li>Drag it to your bookmarks toolbar or add it to your favorites.</li>
<li>When you're on a page you want to add, click the bookmark.</li>
<li>That page will now appear in your <a href="#search" class="nav">search results</a>!</li>
</ol>
<p><a href="" title="Add to search engine" id="add"><span>add</span></a></p>
</div>
<div class="allpages pane">
<h2><span>All pages</span></h2>
<div>
<p>Sorry, it looks like you haven't added any pages yet.</p>
<p>Use the bookmarklet in the <a href="#welcome" class="nav">welcome tab</a> to add some.</p>
</div>
</div>
<div class="prefs pane">
<h2><span>Preferences</span></h2>
<form>
<p>When using the 'web' search option, use this url where <tt>%s</tt> is the query param:</p>
<p><input type="text" /></p>
<p>Enter your own value, or select from the following:</p>
<ul>
<li><a href="http://www.ask.com/web?q=%s" title="ask">ask</a></li>
<li><a href="http://www.bing.com/search?q=%s" title="bing">bing</a></li>
<li><a href="http://www.google.com/#q=%s" title="google" class="def">google</a></li>
<li><a href="http://search.yahoo.com/search?p=%s" title="yahoo">yahoo</a></li>
</ul>
<p><input type="submit" name="save" value="Save" /> <span class="saved" style="visibility:hidden">Saved!</span></p>
</form>
</div>
<div class="about pane">
<h2><span>About</span></h2>
<p>
This is an application I've wanted to write for a long time, but never could due to browser constraints.
</p>
<p>
The <a href="http://10k.aneventapart.com/" title="10k apart">10k apart contest</a> seemed like the perfect 
excuse to finally sit down and actually do it.
</p>
<h2><span>Code</span></h2>
<p>
All the source code for this project is available on github at 
<a href="http://github.com/jimbojw/10k" title="jimbojw/10k">jimbojw/10k</a>.
</p>
<h2><span>Contact</span></h2>
<img src="http://chart.apis.google.com/chart?cht=qr&chs=120x120&chl=MECARD%3AN%3AJim+R.+Wilson%3BTEL%3A8168985108%3BURL%3Ahttp%3A%2F%2Fhexlib.com%2F%3BEMAIL%3Awilson.jim.r%40gmail.com%3B%3B" />
<ul>
<li>Jim R. Wilson</li>
<li><a href="mailto:wilson.jim.r@gmail.com" title="wilson.jim.r@gmail.com">wilson.jim.r@gmail.com</a></li>
<li><a href="http://hexlib.com/" title="hexlib.com">http://hexlib.com/</a></li>
</div>
</div>
<!--/html-->
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script>(function(m){var q=m.localStorage,j=m.JSON.stringify,o=m.JSON.parse;m=m["10kse"]={};for(var g="able|about|across|after|all|almost|also|among|and|any|are|because|been|but|can|cannot|could|dear|did|does|either|else|ever|every|for|from|get|got|had|has|have|her|hers|him|his|how|however|into|its|just|least|let|like|likely|may|might|most|must|neither|nor|not|off|often|only|other|our|own|rather|said|say|says|she|should|since|some|than|that|the|their|them|then|there|these|they|this|tis|too|twas|wants|was|were|what|when|where|which|while|who|whom|why|will|with|would|yet|you|your".split("|"),
f={},k=0,c=g.length;k<c;k++)f[g[k]]=true;m.asc=function(d,a){return d-a};m.get=function(d){return(d=q.getItem("10kse-"+d))?o(d):d};m.set=function(d,a){return q.setItem("10kse-"+d,j(a))};m.stop=f})(window);
(function(m,q){function j(c){var d=q(".pane."+c+", nav ."+c);if(!d.length)throw"no such tab named '"+c+"'";k&&k.removeClass(f);k=d.addClass(f);g("TAB",c)}var o=m.get,g=m.set,f="selected",k;j(o("TAB")||"welcome");q("nav li").click(function(){q(this).hasClass("active")||j(this.className)});q("a.nav").click(function(c){c.preventDefault();c=this.href;c=c.substr(c.lastIndexOf("#")+1);j(c)});m.showtab=j})(window["10kse"],jQuery);
(function(m,q){var j=m.get,o=m.set,g=q(".prefs.pane"),f=g.find("input").eq(0),k=g.find(".saved"),c=j("S")||"";if(!c){c=g.find(".def").attr("href");o("S",c)}f.val(c);g.find("li a").click(function(d){d.preventDefault();f.val(this.href)});g.find("form").submit(function(d){d.preventDefault();c=f.val();o("S",c);k.css({visibility:"",opacity:1});setTimeout(function(){k.animate({opacity:0},"slow")},1E3)})})(window["10kse"],jQuery);
(function(m){function q(g){for(var f=this.data,k,c,d=0,a=g.length;d<a;d++){c=g.charAt(d);(k=f[c])||(k=f[c]={});f=k}f.$=1}function j(g){for(var f=this.data,k,c=0,d=g.length;c<d;c++){k=g.charAt(c);f=f[k];if(!f)return null;f=f}return f}function o(g){var f=this.find(g);if(!f)return[];for(var k=[[g,f]],c=[],d=0,a;k.length;){f=k.shift();g=f[0];f=f[1];if(f.$)c[d++]=g;for(a in f)if(a!=="$")k[k.length]=[g+a,f[a]]}c.sort();return c}m.trie=function(g){return{add:q,data:g,find:j,match:o}}})(window["10kse"],jQuery);
(function(m){m.scanner=function(q,j,o){function g(r,y){var z;if(r.currentStyle)z=r.currentStyle[y];else if(q.getComputedStyle)z=c.getComputedStyle(r,null).getPropertyValue(y);return z}function f(r){return g(r,"display")!=="none"&&g(r,"visiblity")!=="hidden"}function k(r){var y=r.parentNode,z=y.parentNode,A=(r.innerText||r.textContent).replace(h," "),B=A.length;r=1;if(B>25){if(y[b]===o){y[b]=0;d[a++]=y}if(z[b]===o){z[b]=0;d[a++]=y}r+=A.split(",").length;A=B*0.01<<0;r+=A<4?A:3;y[b]+=r;z[b]+=r*0.5}}
var c=j.defaultView,d=[],a=0,b="10score",h=/\s+/g,i,e,l,t,n=j.getElementsByTagName("p");i=0;for(e=n.length;i<e;i++)k(n[i]);n=j.getElementsByTagName("div");var w,u=/<(a|blockquote|dl|div|img|ol|p|pre|table|ul|br)/i;i=0;for(e=n.length;i<e;i++){w=n[i];u.test(w.innerHTML)&&k(w)}u=null;var v;for(i=0;i<a;i++){e=d[i];n=e.getElementsByTagName("a");l=v=0;for(t=n.length;l<t;l++){w=n[l];v+=(w.innerText||w.textContent).length}e[b]=score=e[b]*(1-v/(e.innerText||e.textContent).length);if(!u||score>u[b])u=e}u=u||
j.body;n=j.getSelection()||"";v="h1,h2,h3,h4,h5,h6,pre,code".split(",");w=[];var s,x;i=0;for(e=v.length;i<e;i++){s=j.getElementsByTagName(v[i]);l=0;for(t=s.length;l<t;l++){x=s[l];f(x)&&w.push(x.textContent)}}l=[];u=[u];var p;t=/[a-z][a-z][a-z]/i;for(v=/button|link|noscript|script|style/i;e=u.shift();){s=e.childNodes;i=0;for(e=s.length;i<e;i++){x=s[i];p=x.nodeType;if(p===1&&!v.test(x.tagName)&&f(x))u[u.length]=x;else if(p===3){text=x.nodeValue;if(t.test(text))l[l.length]=text}}}q["10kse"].iframe.contentWindow.postMessage(JSON.stringify({url:j.location.href,
selection:n,title:j.title,priority:w.join(" "),content:l.join(" ")}),"*")}})(window["10kse"]);
(function(m){function q(d){var a,b,h,i=0,e,l={};b=d.split(f);d=0;for(a=b.length;d<a;d++){i++;h=b[d];e=h.toLowerCase();if(h.length>2&&!k[e]){(h=l[e])||(h=l[e]=[]);h[h.length]=i}}return l}function j(d,a,b,h){if((b=""+b)&&/[a-z]/i.test(b)){b=q(b);var i,e,l;for(i in b){e=o("W-"+i)||{};(l=e[d])||(l=e[d]={});l[a]=b[i];g("W-"+i,e);h[i]=1}}}var o=m.get,g=m.set,f=/[^0-9a-z_]+/i,k=m.stop,c=m.trie;m.extract=q;m.indexer=function(d){var a,b=o("URL-"+d.url);if(b){a=b.id;if(d.content!==b.text||d.title!==b.title)g("URL-"+
d.url,{id:a,text:d.content,title:d.title})}else{a=o("COUNT")||0;g("ID-"+a,d.url);g("COUNT",a+1);g("URL-"+d.url,{id:a,text:d.content,title:d.title})}b={};j(a,"s",d.selection,b);j(a,"t",d.title,b);j(a,"p",d.priority,b);j(a,"c",d.content,b);d=o("ALL")||{};a=c(d);var h;for(h in b)a.add(h);g("ALL",d)}})(window["10kse"],window);
(function(m,q,j,o){var g=o.get,f=o.set,k=q.location.href;g=g("K");if(!g){g=Math.random();f("K",g)}k=JSON.stringify(k.replace(/#.*|$/,"#"+g));f="javascript:("+(function(c,d,a){var b=c["10kse"];b||(b=c["10kse"]={});if(b.scanner)return b.scanner();c.addEventListener("message",function(e){if(a.substr(0,e.origin.length)===e.origin){b.scanner=new Function(e.data);b.scanner()}},false);var h=b.iframe=d.createElement("iframe");c=h.style;h.setAttribute("src",a);c.width=c.height="1px";c.top=c.left="-2px";c.border=
"none";c.position="absolute";var i=false;h.onload=h.onreadystatechange=function(){if(!i&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){i=true;h.onload=h.onreadystatechange=null;h.contentWindow.postMessage("script",a)}};d.body.appendChild(h)}+"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/\s+/g," ")+")(window,document,"+k+")";j("#add").attr("href",f).click(function(c){c.preventDefault();alert("1. Drag this link to your bookmarks,\n2. Navigate to another page,\n3. Click the bookmarklet to add that page to your search engine.")});
if(m!==m.top)q.location.hash==="#"+g?m.addEventListener("message",function(c){c.data==="script"?c.source.postMessage("("+o.scanner+")(window,document)","*"):o.indexer(JSON.parse(c.data))},false):alert("Either your bookmarklet is out of date, or a malicious site \nis trying to add itself to your search index. \n\nIn any case, you should update your 'add' bookmarklet. Thanks!")})(window,document,jQuery,window["10kse"]);
(function(m,q,j){if(j===j.top){m=m.get;j=m("COUNT")||0;var o,g;if(j>0)for(var f=q("<ul></ul>").appendTo(q(".allpages").find("div").empty());j>0;){j--;o=m("ID-"+j);g=m("URL-"+o);q("<li><a></a></li>").find("a").attr("href",o).attr("title",g.title).text(g.title).end().appendTo(f)}}})(window["10kse"],jQuery,window);
(function(m,q){var j=m.get,o=Math.log;m.normalize=function(g,f,k){if(f===q)f=1;if(k===q)k=0.5;var c={},d,a,b,h;for(d in g){h=c[d]=g[d]*f;if(a===q||h>a)a=h;if(b===q||h<b)b=h}if(a===b){for(d in c)c[d]=k;return c}for(d in c)c[d]=(c[d]-b)*(1/(a-b));return c};m.topdistance=function(g,f,k,c){c||(c={});var d={},a,b,h,i;for(h in g){i=null;for(var e=0,l=f.length;e<l;e++){a=f[e];if(a.length>2&&!stop[a]){b=c[a];if(b===q)b=c[a]=j("W-"+a);if(b)if(a=b[h])if(a=a[k])if(i===null||a[0]<i)i=a[0]}}if(i!==null)d[h]=i}return d};
m.bm25=function(g,f,k,c){c||(c={});var d={},a,b,h,i={},e=j("COUNT"),l=1/o(1+e),t,n,w,u=1/(2*f.length),v,s;for(h in g){v=0;for(s=f.length;v<s;v++){a=f[v];if(a.length>2&&!stop[a]){b=c[a];if(b===q)b=c[a]=j("W-"+a);if(b)if(b=b[h])if(b=b[k])i[a]=(i[a]||0)+1}}}for(h in g){v=t=0;for(s=f.length;v<s;v++){if(i[a]){w=o((e-i[a]+1)/i[a])*l;a=f[v];if(a.length>2&&!stop[a]){n=0;if(b=c[a])if(b=b[h])if(b=b[k])n=b.length;if(n)t+=n*w/(n+1.2)}}d[h]=0.5+t*u}}return d}})(window["10kse"]);
(function(m,q,j){var o=q("<div></div>");m.highlight=function(g,f,k){if(k===j)k=true;g=o.text(g).html();var c=g.toLowerCase(),d={},a={},b=[],h,i,e,l,t,n;h=0;for(i=f.length;h<i;h++){e=f[h].toLowerCase();l=e.length;if(l>2&&!d[e]){d[e]=true;for(n=t=0;t<3;){n=c.indexOf(e,n);if(n===-1)break;var w=g.charAt(n-1).toLowerCase(),u=g.charAt(n+l).toLowerCase();if((w<"a"||w>"z")&&(u<"a"||u>"z")){t++;b[b.length]=n;a[n]=e}n+=l}}}b.sort(m.asc);f=[];c=0;l=b.length;for(h=n=0;c<200&&h<=l;){d=b[h];e=h<l?g.substr(n,d-
n):g.substr(n);i=e.length;if(k)if(h===l){if(i>50)e=e.substr(0,46)+" ..."}else if(h===0){if(i>50)e="... "+e.substr(i-50-4)}else if(i>100)e=e.substr(0,47)+" ... "+e.substr(i-50-3);f[f.length]=e;c+=e.length;if(h<l){e=a[d];f[f.length]="<b>"+g.substr(d,e.length)+"</b>";c+=e.length;n=d+e.length}h++}if(c>=200&&h<=l)f[f.length]=" ...";return f.join("")}})(window["10kse"],jQuery);
(function(m){var q=m.get,j=m.trie,o,g;m.suggest=function(f){f=f.replace(/^\s+|\s$/g,"").toLowerCase();var k=q("COUNT")||0;if(!f||!k)return[];if(k!==void 0){o=q("ALL");g=j(o)}return g.match(f).slice(0,15)}})(window["10kse"]);
(function(m,q,j){function o(i){function e(){if(s){var p=s.text(),r=n.val(),y=r.lastIndexOf(" ")+1;n.val(v=r.substr(0,y)+p);s.removeClass(b);x=s=null}t()}function l(){if(u.find("li").length){var p=n.offset();w.css({top:p.top+i.offsetHeight,left:p.left,width:i.offsetWidth});w.show()}}function t(){w.hide()}var n=j(i),w=j('<div class="auto"><ul></ul></div>').css({display:"none"}).appendTo(document.body),u=w.find("ul"),v="",s=null,x;n.bind("change keyup",function(p){var r=n.val();p=p.which;if(p===d||p===
k)e();else if(p===g&&s&&x){n.val(n.val().replace(/\s+$/,""));e();n.val(n.val()+" ")}else if(p===a)t();else if(p===f||p===c){x=true;if(s)if(p===f){r=s.prev();if(r.length){s.removeClass(b);s=r.addClass(b)}}else{r=s.next();if(r.length){s.removeClass(b);s=r.addClass(b)}}else s=u.find("li").eq(0).addClass(b);l()}else if(r!==v){v=r;p=r.lastIndexOf(" ");r=r.substr(p<0?0:p).toLowerCase();if(r.length)if((p=h(r))&&p.length){u.empty();s=null;for(var y=0,z=p.length;y<z;y++)j("<li><span></span></li>").appendTo(u).find("span").html(p[y].split(r,
2).join("<b>"+r+"</b>"));l()}else t();else t()}}).parent("form").submit(e);u.mouseover(function(p){p=j(p.target);p=p.is("li")?p:p.parent("li");if(p=p.length?p:null){x=null;s&&s.get(0)!==p.get(0)&&s.removeClass(b);s=p.addClass(b)}}).click(e);j("body").click(t)}var g=32,f=38,k=39,c=40,d=13,a=27,b="selected",h=q.suggest;j(".search input").eq(0).each(function(){o(this)});q.autocomplete=o})(window,window["10kse"],jQuery);
(function(m,q,j,o){function g(){var a=(c.val()||"").replace(/^\s+|\s+$/g,""),b=a.toLowerCase().split(/[^a-z0-9_]/),h,i,e={},l,t={};if(!(!a||a===d)){d=a;h=0;for(i=b.length;h<i;h++){a=b[h];if(!t[a])if(a=t[a]=f("W-"+a))for(l in a)e[l]=(e[l]||0)+1}a=j.normalize;var n=j.topdistance,w=j.bm25;e=[[1,a(n(e,b,"s",t),-1)],[1,a(n(e,b,"t",t),-1)],[1,a(n(e,b,"p",t),-1)],[1,a(n(e,b,"c",t),-1)],[2.5,a(w(e,b,"s",t))],[2,a(w(e,b,"t",t))],[1.5,a(w(e,b,"p",t))],[1,a(w(e,b,"c",t))]];var u={};h=0;for(i=e.length;h<i;h++){a=
e[h];t=a[0];a=a[1];for(l in a){u[l]||(u[l]=0);u[l]+=t*a[l]}}var v=[];e=0;var s={},x,p;for(l in u){x=u[l];p=s[x]||(s[x]=[]);p[p.length]=l;v[e++]=x}v.sort(j.asc);v.reverse();var r=j.highlight,y=null;k.slideUp("slow",function(){k.empty();h=0;for(i=v.length;h<i;h++){x=v[h];if(x!==y){y=x;p=s[x];for(var z=0,A=p.length;z<A;z++){l=p[z];var B=f("ID-"+l),C=f("URL-"+B),D=C.text;k.append(o("<dt><a></a></dt>").find("a").attr("href",B).attr("title",C.title).html(r(C.title,b,false)).end(),o("<dd><p></p></dd>").find("p").html(r(D,
b)).end().append("<p><strong>Score: "+(u[l]+"").substr(0,4)+"</strong></p>"))}}}k.slideDown("slow")})}}var f=j.get,k=o(".results dl"),c=o(".search input").eq(0),d;o("form").submit(function(a){a.preventDefault();setTimeout(g,150)});o(".search").find("input[name=web]").click(function(){m.location.assign((f("S")||"").replace("%s",encodeURIComponent(c.val()||"")))});o(function(){c.focus()})})(window,document,window["10kse"],jQuery);
</script>
</body>
</html>

