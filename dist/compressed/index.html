<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>10k personal search engine</title>
<style type="text/css">body{font-family:'Helvetica Neue',Arial,'Liberation Sans',FreeSans,sans-serif;width:600px;margin:0 auto;background:#eee;}h1{background:#036;color:white;padding:1em 0;font-size:2.5em;text-align:center;background-image:-moz-linear-gradient(center bottom,#1b4080 32%,#486bb3 72%);background-image:-webkit-gradient(linear,left bottom,left top,color-stop(0.32,#1b4080),color-stop(0.72,#486bb3));-moz-border-radius:8px;border-radius:8px;text-shadow:#333 1px 1px 1px;}dt{font-size:1.1em;}dd{margin-left:0;margin-bottom:2.5em;}dd p{margin:1em 0;}a,a:visited{color:#06c;}input[type=text]{width:100%;border:1px solid #aaa;}input[type=submit],input[type=button]{border:1px solid #aaa;background-image:-moz-linear-gradient(center bottom,#ddd 32%,#f3f3f3 72%);background-image:-webkit-gradient(linear,left bottom,left top,color-stop(0.32,#ddd),color-stop(0.72,#f3f3f3));-moz-border-radius:3px;border-radius:2px;padding:.25em 1em;font-size:medium;}.search form p{text-align:center;}.results{margin-top:2em;}.pane{clear:both;background:white;border:1px solid #aaa;margin-bottom:1em;padding:0 1em 1em;-moz-border-radius:8px;border-radius:8px;display:none;min-height:250px;}.pane.selected{display:inherit;}ul{list-style-type:square;color:#06c;}li{margin-bottom:.5em;}#add{display:block;margin:1em auto;width:5em;background:#f30;color:white;padding:.5em;font-size:2.5em;text-align:center;background-image:-moz-linear-gradient(center bottom,#c92200 32%,#f30 72%);background-image:-webkit-gradient(linear,left bottom,left top,color-stop(0.32,#c92200),color-stop(0.72,#f30));-moz-border-radius:8px;border-radius:8px;text-shadow:#333 1px 1px 1px;text-decoration:none;}.prefs ul{margin:0;padding:0;list-style-type:none;}.prefs li{display:inline;padding:0 2em;}.saved{background:#ff0;padding:.5em 1em;}.about img{float:right;padding:0;margin:0;position:relative;top:-30px;}.about p{margin:1em;}.allpages p{margin:1em;}nav ul{margin:0 1em;padding:0;list-style-type:none;}nav li{float:left;margin:0 .6em;padding:.25em 1em;background:#ddd;-moz-border-radius-topRight:6px;-moz-border-radius-topLeft:6px;border-top-right-radius:6px;border-top-left-radius:6px;border:1px solid #aaa;border-bottom:none;color:#444;cursor:pointer;}nav .selected{color:#06c;background:#fff;z-index:1;position:relative;top:1px;}.auto{position:absolute;background:#fff;padding:0;margin:0;border:none;}.auto ul{margin:0;padding:0;list-style-type:none;border:1px solid #ccc;}.auto li{margin:0;padding:.25em .5em;}.auto .selected{background:#f0f0f0;}</style>
</head>
<body>
<!--html-->
<div class="container">
<h1><span>10k personal search engine</span></h1>
<nav>
<ul>
<li class="welcome">welcome</li>
<li class="search">search</li>
<li class="allpages">all pages</li>
<li class="prefs">preferences</li>
<li class="about">about</li>
</ul>
</nav>
<div class="search pane">
<div>
<h2><span>Search</span></h2>
<form>
<p><input type="text" name="search" autocomplete="off" /></p>
<p>
<input type="submit" name="submit" value="Search" />
<input type="button" name="web" value="Web" />
</p>
</form>
</div>
<div class="results"><dl></dl></div>
</div>
<div class="welcome pane">
<h2><span>Welcome</span></h2>
<p>
The 'add' button below is a 
<a href="http://en.wikipedia.org/wiki/Bookmarklet" title="wikipedia:bookmarklet">bookmarklet</a>.
</p>
<ol>
<li>Drag it to your bookmarks toolbar or add it to your favorites.</li>
<li>When you're on a page you want to add, click the bookmark.</li>
<li>That page will now appear in your <a href="#search" class="nav">search results</a>!</li>
</ol>
<p><a href="" title="Add to search engine" id="add"><span>add</span></a></p>
<p>* Adding some pages may take a while, please be patient - it's worth it!</p>
</div>
<div class="allpages pane">
<h2><span>All pages</span></h2>
<div>
<p>Sorry, it looks like you haven't added any pages yet.</p>
<p>Use the bookmarklet in the <a href="#welcome" class="nav">welcome tab</a> to add some.</p>
</div>
</div>
<div class="prefs pane">
<h2><span>Preferences</span></h2>
<form>
<p>When using the 'web' search option, use this url where <tt>%s</tt> is the query param:</p>
<p><input type="text" /></p>
<p>Enter your own value, or select from the following:</p>
<ul>
<li><a href="http://www.ask.com/web?q=%s" title="ask">ask</a></li>
<li><a href="http://www.bing.com/search?q=%s" title="bing">bing</a></li>
<li><a href="http://www.google.com/#q=%s" title="google" class="def">google</a></li>
<li><a href="http://search.yahoo.com/search?p=%s" title="yahoo">yahoo</a></li>
</ul>
<p><input type="submit" name="save" value="Save" /> <span class="saved" style="visibility:hidden">Saved!</span></p>
</form>
</div>
<div class="about pane">
<h2><span>About</span></h2>
<p>
This is an application I've wanted to write for a long time, but never could due to browser constraints.
</p>
<p>
The <a href="http://10k.aneventapart.com/" title="10k apart">10k apart contest</a> seemed like the perfect 
excuse to finally sit down and actually do it.
</p>
<h2><span>Code</span></h2>
<p>
All the source code for this project is available on github at 
<a href="http://github.com/jimbojw/10k" title="jimbojw/10k">jimbojw/10k</a>.
</p>
<h2><span>Contact</span></h2>
<img src="http://chart.apis.google.com/chart?cht=qr&chs=120x120&chl=MECARD%3AN%3AJim+R.+Wilson%3BTEL%3A8168985108%3BURL%3Ahttp%3A%2F%2Fhexlib.com%2F%3BEMAIL%3Awilson.jim.r%40gmail.com%3B%3B" />
<ul>
<li>Jim R. Wilson</li>
<li><a href="mailto:wilson.jim.r@gmail.com" title="wilson.jim.r@gmail.com">wilson.jim.r@gmail.com</a></li>
<li><a href="http://hexlib.com/" title="hexlib.com">http://hexlib.com/</a></li>
</div>
</div>
<!--/html-->
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script>(function(n){var q=n.localStorage,k=n.JSON.stringify,o=n.JSON.parse;n=n["10kse"]={};for(var g="able|about|across|after|all|almost|also|among|and|any|are|because|been|but|can|cannot|could|dear|did|does|either|else|ever|every|for|from|get|got|had|has|have|her|hers|him|his|how|however|into|its|just|least|let|like|likely|may|might|most|must|neither|nor|not|off|often|only|other|our|own|rather|said|say|says|she|should|since|some|than|that|the|their|them|then|there|these|they|this|tis|too|twas|wants|was|were|what|when|where|which|while|who|whom|why|will|with|would|yet|you|your".split("|"),
f={},l=0,c=g.length;l<c;l++)f[g[l]]=true;n.asc=function(d,b){return d-b};n.get=function(d){return(d=q.getItem("10kse-"+d))?o(d):d};n.set=function(d,b){return q.setItem("10kse-"+d,k(b))};n.stop=f})(window);
(function(n,q){function k(c){var d=q(".pane."+c+", nav ."+c);if(!d.length)throw"no such tab named '"+c+"'";l&&l.removeClass(f);l=d.addClass(f);g("TAB",c)}var o=n.get,g=n.set,f="selected",l;k(o("TAB")||"welcome");q("nav li").click(function(){q(this).hasClass("active")||k(this.className)});q("a.nav").click(function(c){c.preventDefault();c=this.href;c=c.substr(c.lastIndexOf("#")+1);k(c)});n.showtab=k})(window["10kse"],jQuery);
(function(n,q){var k=n.get,o=n.set,g=q(".prefs.pane"),f=g.find("input").eq(0),l=g.find(".saved"),c=k("S")||"";if(!c){c=g.find(".def").attr("href");o("S",c)}f.val(c);g.find("li a").click(function(d){d.preventDefault();f.val(this.href)});g.find("form").submit(function(d){d.preventDefault();c=f.val();o("S",c);l.css({visibility:"",opacity:1});setTimeout(function(){l.animate({opacity:0},"slow")},1E3)})})(window["10kse"],jQuery);
(function(n){function q(g){for(var f=this.data,l,c,d=0,b=g.length;d<b;d++){c=g.charAt(d);(l=f[c])||(l=f[c]={});f=l}f.$=1}function k(g){for(var f=this.data,l,c=0,d=g.length;c<d;c++){l=g.charAt(c);f=f[l];if(!f)return null;f=f}return f}function o(g){var f=this.find(g);if(!f)return[];for(var l=[[g,f]],c=[],d=0,b;l.length;){f=l.shift();g=f[0];f=f[1];if(f.$)c[d++]=g;for(b in f)if(b!=="$")l[l.length]=[g+b,f[b]]}c.sort();return c}n.trie=function(g){return{add:q,data:g,find:k,match:o}}})(window["10kse"],jQuery);
(function(n){n.scanner=function(q,k,o){function g(r,y){var z;if(r.currentStyle)z=r.currentStyle[y];else if(q.getComputedStyle)z=c.getComputedStyle(r,null).getPropertyValue(y);return z}function f(r){return g(r,"display")!=="none"&&g(r,"visiblity")!=="hidden"}function l(r){var y=r.parentNode,z=y.parentNode,A=(r.innerText||r.textContent).replace(h," "),B=A.length;r=1;if(B>25){if(y[a]===o){y[a]=0;d[b++]=y}if(z[a]===o){z[a]=0;d[b++]=y}r+=A.split(",").length;A=B*0.01<<0;r+=A<4?A:3;y[a]+=r;z[a]+=r*0.5}}
var c=k.defaultView,d=[],b=0,a="10score",h=/\s+/g,i,e,m,t,j=k.getElementsByTagName("p");i=0;for(e=j.length;i<e;i++)l(j[i]);j=k.getElementsByTagName("div");var w,u=/<(a|blockquote|dl|div|img|ol|p|pre|table|ul|br)/i;i=0;for(e=j.length;i<e;i++){w=j[i];u.test(w.innerHTML)&&l(w)}u=null;var v;for(i=0;i<b;i++){e=d[i];j=e.getElementsByTagName("a");m=v=0;for(t=j.length;m<t;m++){w=j[m];v+=(w.innerText||w.textContent).length}e[a]=score=e[a]*(1-v/(e.innerText||e.textContent).length);if(!u||score>u[a])u=e}u=u||
k.body;j=k.getSelection()||"";v="h1,h2,h3,h4,h5,h6,pre,code".split(",");w=[];var s,x;i=0;for(e=v.length;i<e;i++){s=k.getElementsByTagName(v[i]);m=0;for(t=s.length;m<t;m++){x=s[m];f(x)&&w.push(x.textContent)}}m=[];u=[u];var p;t=/[a-z][a-z][a-z]/i;for(v=/button|link|noscript|script|style/i;e=u.shift();){s=e.childNodes;i=0;for(e=s.length;i<e;i++){x=s[i];p=x.nodeType;if(p===1&&!v.test(x.tagName)&&f(x))u[u.length]=x;else if(p===3){text=x.nodeValue;if(t.test(text))m[m.length]=text}}}q["10kse"].iframe.contentWindow.postMessage(JSON.stringify({url:k.location.href,
selection:j,title:k.title,priority:w.join(" "),content:m.join(" ")}),"*")}})(window["10kse"]);
(function(n){function q(d){var b,a,h,i=0,e,m={};a=d.split(f);d=0;for(b=a.length;d<b;d++){i++;h=a[d];e=h.toLowerCase();if(h.length>2&&!l[e]){(h=m[e])||(h=m[e]=[]);h[h.length]=i}}return m}function k(d,b,a,h){if((a=""+a)&&/[a-z]/i.test(a)){a=q(a);var i,e,m;for(i in a){e=o("W-"+i)||{};(m=e[d])||(m=e[d]={});m[b]=a[i];g("W-"+i,e);h[i]=1}}}var o=n.get,g=n.set,f=/[^0-9a-z_]+/i,l=n.stop,c=n.trie;n.extract=q;n.indexer=function(d){var b,a=o("URL-"+d.url);if(a){b=a.id;if(d.content!==a.text||d.title!==a.title)g("URL-"+
d.url,{id:b,text:d.content,title:d.title})}else{b=o("COUNT")||0;g("ID-"+b,d.url);g("COUNT",b+1);g("URL-"+d.url,{id:b,text:d.content,title:d.title})}a={};k(b,"s",d.selection,a);k(b,"t",d.title,a);k(b,"p",d.priority,a);k(b,"c",d.content,a);d=o("ALL")||{};b=c(d);var h;for(h in a)b.add(h);g("ALL",d)}})(window["10kse"],window);
(function(n,q,k,o){var g=o.get,f=o.set,l=q.location.href;g=g("K");if(!g){g=Math.random();f("K",g)}l=JSON.stringify(l.replace(/#.*|$/,"#"+g));f="javascript:("+(function(c,d,b){var a=c["10kse"];a||(a=c["10kse"]={});if(a.scanner)return a.scanner();c.addEventListener("message",function(e){if(b.substr(0,e.origin.length)===e.origin){a.scanner=new Function(e.data);a.scanner()}},false);var h=a.iframe=d.createElement("iframe");c=h.style;h.setAttribute("src",b);c.width=c.height="1px";c.top=c.left="-2px";c.border=
"none";c.position="absolute";var i=false;h.onload=h.onreadystatechange=function(){if(!i&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){i=true;h.onload=h.onreadystatechange=null;h.contentWindow.postMessage("script",b)}};d.body.appendChild(h)}+"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/\s+/g," ")+")(window,document,"+l+")";k("#add").attr("href",f).click(function(c){c.preventDefault();alert("1. Drag this link to your bookmarks,\n2. Navigate to another page,\n3. Click the bookmarklet to add that page to your search engine.")});
if(n!==n.top)q.location.hash==="#"+g?n.addEventListener("message",function(c){c.data==="script"?c.source.postMessage("("+o.scanner+")(window,document)","*"):o.indexer(JSON.parse(c.data))},false):alert("Either your bookmarklet is out of date, or a malicious site \nis trying to add itself to your search index. \n\nIn any case, you should update your 'add' bookmarklet. Thanks!")})(window,document,jQuery,window["10kse"]);
(function(n,q,k){if(k===k.top){n=n.get;k=n("COUNT")||0;var o,g;if(k>0)for(var f=q("<ul></ul>").appendTo(q(".allpages").find("div").html("<p>Page count: "+k+"</p>"));k>0;){k--;o=n("ID-"+k);g=n("URL-"+o);q("<li><a></a></li>").find("a").attr("href",o).attr("title",g.title).text(g.title).end().appendTo(f)}}})(window["10kse"],jQuery,window);
(function(n,q){var k=n.get,o=Math.log;n.normalize=function(g,f,l){if(f===q)f=1;if(l===q)l=0.5;var c={},d,b,a,h;for(d in g){h=c[d]=g[d]*f;if(b===q||h>b)b=h;if(a===q||h<a)a=h}if(b===a){for(d in c)c[d]=l;return c}for(d in c)c[d]=(c[d]-a)*(1/(b-a));return c};n.topdistance=function(g,f,l,c){c||(c={});var d={},b,a,h,i;for(h in g){i=null;for(var e=0,m=f.length;e<m;e++){b=f[e];if(b.length>2&&!stop[b]){a=c[b];if(a===q)a=c[b]=k("W-"+b);if(a)if(b=a[h])if(b=b[l])if(i===null||b[0]<i)i=b[0]}}if(i!==null)d[h]=i}return d};
n.bm25=function(g,f,l,c){c||(c={});var d={},b,a,h,i={},e=k("COUNT"),m=1/o(1+e),t,j,w,u=1/(2*f.length),v,s;for(h in g){v=0;for(s=f.length;v<s;v++){b=f[v];if(b.length>2&&!stop[b]){a=c[b];if(a===q)a=c[b]=k("W-"+b);if(a)if(a=a[h])if(a=a[l])i[b]=(i[b]||0)+1}}}for(h in g){v=t=0;for(s=f.length;v<s;v++){if(i[b]){w=o((e-i[b]+1)/i[b])*m;b=f[v];if(b.length>2&&!stop[b]){j=0;if(a=c[b])if(a=a[h])if(a=a[l])j=a.length;if(j)t+=j*w/(j+1.2)}}d[h]=0.5+t*u}}return d}})(window["10kse"]);
(function(n,q,k){var o=q("<div></div>");n.highlight=function(g,f,l){if(l===k)l=true;g=o.text(g).html();var c=g.toLowerCase(),d={},b={},a=[],h,i,e,m,t,j;h=0;for(i=f.length;h<i;h++){e=f[h].toLowerCase();m=e.length;if(m>2&&!d[e]){d[e]=true;for(j=t=0;t<3;){j=c.indexOf(e,j);if(j===-1)break;var w=g.charAt(j-1).toLowerCase(),u=g.charAt(j+m).toLowerCase();if((w<"a"||w>"z")&&(u<"a"||u>"z")){t++;a[a.length]=j;b[j]=e}j+=m}}}a.sort(n.asc);f=[];c=0;m=a.length;for(h=j=0;c<200&&h<=m;){d=a[h];e=h<m?g.substr(j,d-
j):g.substr(j);i=e.length;if(l)if(h===m){if(i>50)e=e.substr(0,46)+" ..."}else if(h===0){if(i>50)e="... "+e.substr(i-50-4)}else if(i>100)e=e.substr(0,47)+" ... "+e.substr(i-50-3);f[f.length]=e;c+=e.length;if(h<m){e=b[d];f[f.length]="<b>"+g.substr(d,e.length)+"</b>";c+=e.length;j=d+e.length}h++}if(c>=200&&h<=m)f[f.length]=" ...";return f.join("")}})(window["10kse"],jQuery);
(function(n){var q=n.get,k=n.trie,o,g;n.suggest=function(f){f=f.replace(/^\s+|\s$/g,"").toLowerCase();var l=q("COUNT")||0;if(!f||!l)return[];if(l!==void 0){o=q("ALL");g=k(o)}return g.match(f).slice(0,15)}})(window["10kse"]);
(function(n,q,k){function o(i){function e(){if(s){var p=s.text(),r=j.val(),y=r.lastIndexOf(" ")+1;j.val(v=r.substr(0,y)+p);s.removeClass(a);x=s=null}t()}function m(){if(u.find("li").length){var p=j.offset();w.css({top:p.top+i.offsetHeight,left:p.left,width:i.offsetWidth});w.show()}}function t(){w.hide()}var j=k(i),w=k('<div class="auto"><ul></ul></div>').css({display:"none"}).appendTo(document.body),u=w.find("ul"),v="",s=null,x;j.bind("change keyup",function(p){var r=j.val();p=p.which;if(p===d||p===
l)e();else if(p===g&&s&&x){j.val(j.val().replace(/\s+$/,""));e();j.val(j.val()+" ")}else if(p===b)t();else if(p===f||p===c){x=true;if(s)if(p===f){r=s.prev();if(r.length){s.removeClass(a);s=r.addClass(a)}}else{r=s.next();if(r.length){s.removeClass(a);s=r.addClass(a)}}else s=u.find("li").eq(0).addClass(a);m()}else if(r!==v){v=r;p=r.lastIndexOf(" ");r=r.substr(p<0?0:p).toLowerCase();if(r.length)if((p=h(r))&&p.length){u.empty();s=null;for(var y=0,z=p.length;y<z;y++)k("<li><span></span></li>").appendTo(u).find("span").html(p[y].split(r,
2).join("<b>"+r+"</b>"));m()}else t();else t()}}).parent("form").submit(e);u.mouseover(function(p){p=k(p.target);p=p.is("li")?p:p.parent("li");if(p=p.length?p:null){x=null;s&&s.get(0)!==p.get(0)&&s.removeClass(a);s=p.addClass(a)}}).click(e);k("body").click(t)}var g=32,f=38,l=39,c=40,d=13,b=27,a="selected",h=q.suggest;k(".search input").eq(0).each(function(){o(this)});q.autocomplete=o})(window,window["10kse"],jQuery);
(function(n,q,k,o){function g(){var b=(c.val()||"").replace(/^\s+|\s+$/g,""),a=b.toLowerCase().split(/[^a-z0-9_]/),h,i,e={},m,t={},j=false;if(!(!b||b===d)){d=b;h=0;for(i=a.length;h<i;h++){b=a[h];if(!t[b])if(b=t[b]=f("W-"+b)){for(m in b)e[m]=(e[m]||0)+1;j=true}}if(j){j=k.normalize;b=k.topdistance;var w=k.bm25;e=[[1,j(b(e,a,"s",t),-1)],[1,j(b(e,a,"t",t),-1)],[1,j(b(e,a,"p",t),-1)],[1,j(b(e,a,"c",t),-1)],[2.5,j(w(e,a,"s",t))],[2,j(w(e,a,"t",t))],[1.5,j(w(e,a,"p",t))],[1,j(w(e,a,"c",t))]];var u={};h=
0;for(i=e.length;h<i;h++){j=e[h];t=j[0];j=j[1];for(m in j){u[m]||(u[m]=0);u[m]+=t*j[m]}}var v=[];e=0;var s={},x,p;for(m in u){x=u[m];p=s[x]||(s[x]=[]);p[p.length]=m;v[e++]=x}v.sort(k.asc);v.reverse();var r=k.highlight,y=null;l.slideUp("slow",function(){l.empty();h=0;for(i=v.length;h<i;h++){x=v[h];if(x!==y){y=x;p=s[x];for(var z=0,A=p.length;z<A;z++){m=p[z];var B=f("ID-"+m),C=f("URL-"+B),D=C.text;l.append(o("<dt><a></a></dt>").find("a").attr("href",B).attr("title",C.title).html(r(C.title,a,false)).end(),
o("<dd><p></p></dd>").find("p").html(r(D,a)).end().append("<p><strong>Score: "+(u[m]+"").substr(0,4)+"</strong></p>"))}}}l.slideDown("slow")})}else l.slideUp("slow",function(){l.html("<dt>Sorry, no pages were found to match your query. :/</dt><dd><p>You should probably try searching for something else.</p></dd>");l.slideDown("slow")})}}var f=k.get,l=o(".results dl"),c=o(".search input").eq(0),d;o("form").submit(function(b){b.preventDefault();setTimeout(g,150)});o(".search").find("input[name=web]").click(function(){n.location.assign((f("S")||
"").replace("%s",encodeURIComponent(c.val()||"")))});o(function(){c.focus()})})(window,document,window["10kse"],jQuery);
</script>
</body>
</html>

